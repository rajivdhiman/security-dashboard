import {Box, Chip, IconButton, Stack, Typography} from "@mui/material";
import ArrowForwardIcon from "@mui/icons-material/ArrowForward";
import CompareArrowsIcon from "@mui/icons-material/CompareArrows";

function severityColor(sev: string) {
    switch (sev) {
        case "critical":
            return "error";
        case "high":
            return "warning";
        case "medium":
            return "info";
        default:
            return "default";
    }
}

type Props = {
    cve: string;
    severity: string;
    packageName: string;
    image: string;
    onOpen?: () => void;
    onCompare?: () => void;
};

export default function VulnerabilityRow({
                                             cve,
                                             severity,
                                             packageName,
                                             image,
                                             onOpen,
                                             onCompare,
                                         }: Props) {
    return (
        <Box
            onClick={onOpen}
            role="button"
            tabIndex={0}
            onKeyDown={(e) => e.key === "Enter" && onOpen?.()}
            sx={{
                px: 2,
                py: 1.5,
                borderBottom: "1px solid",
                borderColor: "divider",
                display: "flex",
                alignItems: "center",
                justifyContent: "space-between",
                cursor: onOpen ? "pointer" : "default",
                "&:hover": { bgcolor: "grey.100" },
            }}
        >
            <Stack spacing={0.5}>
                <Stack direction="row" spacing={1} alignItems="center">
                    <Typography fontWeight={700}>{cve}</Typography>
                    <Chip size="small" label={severity.toUpperCase()} color={severityColor(severity)} />
                </Stack>

                <Typography variant="body2" color="text.secondary">
                    {packageName} â€” {image}
                </Typography>
            </Stack>

            <Stack direction="row" onClick={(e) => e.stopPropagation()}>
                <IconButton size="small" onClick={onCompare}>
                    <CompareArrowsIcon fontSize="small" />
                </IconButton>
                <IconButton size="small" onClick={onOpen}>
                    <ArrowForwardIcon fontSize="small" />
                </IconButton>
            </Stack>
        </Box>
    );
}